<html>
<head>
<title>cachetur bookmarklets</title>
</head>
<body>
<h3>cachetur bookmarklets</h3>
If your browser supports the Cachetur Assistant, you should use it rather than these bookmarklets. Mobile devices do not support plugins/extensions so there is no easy way to add caches to cachetur from a web page view. These bookmarklets help with that. The "Set Trip" bookmarklet adds a dropdown selector to the geocaching.com page where you can choose which trip you want to add caches to. Once selected, that remains the default trip until you select a different one. The "Add Cache" bookmarklet adds the current cache you are viewing or the selected cache on the map to the default trip and briefly displays a message confirming this was done. 
<h3>Installing the bookmarklets in a web browser</h3>
<p>Add cachetur bookmarklets to your web browser by dragging them to the browser bar. You can rename them to suit yourself using the browser Bookmark Manager. 
<br><br>
<a href="javascript: function ctAddList(listStr) {var data = JSON.parse(listStr).data;var tripId = localStorage.getItem("ctTrip");var header = document.getElementsByClassName("menu")[0];var options = "";var selected = '"';if (data.length > 0) {data.forEach(function(item) {if (tripId === item.id) {selected = '" selected';}options = options + '<option value="' + item.id + selected + '>' + item.turnavn + '</option>';selected='"';});}var ctSel = '<div id="ct-header-text" style="padding-left:5px"><select id="cachetur-tur-valg">' + options + '</select>' + '</div>';header.insertAdjacentHTML('afterend', ctSel);var ctTripSelector = document.getElementById("cachetur-tur-valg");ctTripSelector.addEventListener('change', function() {localStorage.setItem("ctTrip", ctTripSelector.value);localStorage.setItem("ctTripName", ctTripSelector.options[ctTripSelector.selectedIndex].text);});}function ctGetTrips() {if (document.getElementById("ct-header")) {return;}var req = new XMLHttpRequest();req.open('GET', 'https://cachetur.no/api/planlagt_list_editable?format=json', true);req.withCredentials = true;req.onreadystatechange = function() {if (req.readyState === 4) {if (req.status >= 200 && req.status < 400) {ctAddList(req.responseText);}}};req.send();}ctGetTrips();">Set Trip</a>
&nbsp;&nbsp;&nbsp;
<a href="javascript:function cacheturAdd() { var tripId = localStorage.getItem("ctTrip");var gccode;var mainDiv;if (location.href.indexOf("geocaching.com/map") != -1) {var codeElts = document.getElementsByClassName("code");if (codeElts !== undefined) {gccode = codeElts[0].innerHTML;mainDiv = document.getElementsByClassName("wrapper")[0];}}if (location.href.indexOf("geocaching.com/geocache") != -1) {mainDiv = document.getElementById("divContentMain");var ctParts = location.href.split("/");gccode = ctParts[ctParts.length - 1].split("_");}if (tripId && gccode) {var req = new XMLHttpRequest();req.open('GET', 'https://cachetur.no/api/planlagt_add_codes?format=json&tur=' + tripId + '&code='+gccode, true);req.withCredentials = true;req.onreadystatechange = function() {if (req.readyState === 4) {if (req.status >= 200 && req.status < 400) {var okMsg = '<div id="ctOkMsg" style="position:fixed;top:200px;left:200px;z-index:9999;font-size:20px;border:5px solid #0f0;opacity:1;background-color:#fff">&nbsp;&#x2714; ' +  localStorage.getItem("ctTripName") + '&nbsp;</div>';mainDiv.insertAdjacentHTML('afterbegin', okMsg);setTimeout(function(){ var elem = document.querySelector('#ctOkMsg');elem.parentNode.removeChild(elem); }, 2000);}}};req.send();}}cacheturAdd();">Add Cache</a>

<h3>Installing the bookmarklets in a mobile browser</h3>
  <h4>Chrome</h4>
  On iOS, long press one of the two links above and choose "Copy Link URL". Tap the star in the URL bar to create a bookmark and then tap "Edit" when it is displayed at the bottom of the screen.
  In the "Edit Bookmark" dialog, change the name to suit (like "Set Trip" maybe). Tap the URL field and use the X to clear the field. Then tape the empty field and Paste the URL text you copied earlier. Finally, tape DONE.
  To use the bookmarklet, when on a web cache page, use the Bookmarklets menu item to select the bookmarklet you defined.
  <h4>Safari</h4>
Select all the text in one of the text areas below and copy it. Then tap the Share icon (box with arrow exiting to the top) and choose "Add Bookmark".
  In the Add Bookmark Dialog, change the name to be appropriate (e.g. Set Trip). For reasons known only to Apple, you cannot edit the URL part here so just tap Save.
  Then tap the book icon to the left of the URL bar and tap the book icon selector if not already selected. Then tap "Edit" to edit bookmarks. Tap your newly created bookmark so you can
  change it's URL to the copied bookmarklet definiton. Tap the field below the name and use the x to clear the field. Tap the now empty field and Paste the bookmarklet definition. Then Tap the Edit Bookmark back link to go back to the list of bookmarks.
  Finally, tap Done to indicate you are done editing bookmarks.
<br><br>Set Trip<br>
<textarea>
javascript: function ctAddList(listStr) {var data = JSON.parse(listStr).data;var tripId = localStorage.getItem("ctTrip");var header = document.getElementsByClassName("menu")[0];var options = "";var selected = '"';if (data.length > 0) {data.forEach(function(item) {if (tripId === item.id) {selected = '" selected';}options = options + '<option value="' + item.id + selected + '>' + item.turnavn + '</option>';selected='"';});}var ctSel = '<div id="ct-header-text" style="padding-left:5px"><select id="cachetur-tur-valg">' + options + '</select>' + '</div>';header.insertAdjacentHTML('afterend', ctSel);var ctTripSelector = document.getElementById("cachetur-tur-valg");ctTripSelector.addEventListener('change', function() {localStorage.setItem("ctTrip", ctTripSelector.value);localStorage.setItem("ctTripName", ctTripSelector.options[ctTripSelector.selectedIndex].text);});}function ctGetTrips() {if (document.getElementById("ct-header")) {return;}var req = new XMLHttpRequest();req.open('GET', 'https://cachetur.no/api/planlagt_list_editable?format=json', true);req.withCredentials = true;req.onreadystatechange = function() {if (req.readyState === 4) {if (req.status >= 200 && req.status < 400) {ctAddList(req.responseText);}}};req.send();}ctGetTrips();</textarea>
<br>Add Cache<br>
<textarea>
javascript:function cacheturAdd() { var tripId = localStorage.getItem("ctTrip");var gccode;var mainDiv;if (location.href.indexOf("geocaching.com/map") != -1) {var codeElts = document.getElementsByClassName("code");if (codeElts !== undefined) {gccode = codeElts[0].innerHTML;mainDiv = document.getElementsByClassName("wrapper")[0];}}if (location.href.indexOf("geocaching.com/geocache") != -1) {mainDiv = document.getElementById("divContentMain");var ctParts = location.href.split("/");gccode = ctParts[ctParts.length - 1].split("_");}if (tripId && gccode) {var req = new XMLHttpRequest();req.open('GET', 'https://cachetur.no/api/planlagt_add_codes?format=json&tur=' + tripId + '&code='+gccode, true);req.withCredentials = true;req.onreadystatechange = function() {if (req.readyState === 4) {if (req.status >= 200 && req.status < 400) {var okMsg = '<div id="ctOkMsg" style="position:fixed;top:200px;left:200px;z-index:9999;font-size:20px;border:5px solid #0f0;opacity:1;background-color:#fff">&nbsp;&#x2714; ' +  localStorage.getItem("ctTripName") + '&nbsp;</div>';mainDiv.insertAdjacentHTML('afterbegin', okMsg);setTimeout(function(){ var elem = document.querySelector('#ctOkMsg');elem.parentNode.removeChild(elem); }, 2000);}}};req.send();}}cacheturAdd();</textarea>
